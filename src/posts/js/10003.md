---
lang: zh-CN
title: debounce 防抖函数
category:
    - JavaScript
tag:
    - 性能优化
order: 3
---

## 概述
- 当事件触发时，回调函数 `callbackFn` 不会立即执行，而是等待一段时间
- 若等待时间内没有再次触发事件，则执行回调函数 `callbackFn`
- 当事件被频繁触发时，防抖函数 `debounce` 表现为延迟执行

## 实现
```js
function debounce(callbackFn, delay, immediate = false) {
    let timer = null
    let done = false    // 是否执行过

    function _debounce(...args) {
        if (timer) {
            clearTimer(timer)
        }

        if (immediate && !done) {
            callbackFn.apply(this, args)
            done = true
        } else {
            timer = setTimeout(() => {
                callbackFn.apply(this, args)
            }, delay)
            // 重置执行状态
            done = false
        }
    }

    return _debounce
}
```

## 示例
```js
const handleClick = (e) => {
    console.log('Click!', e, this)
}
const el = document.getElementById('my-btn')
// 延迟 300ms，立即触发
el.onclick = debounce(handleClick, 300, true)
```
