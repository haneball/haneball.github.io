---
lang: zh-CN
title: 实现 Array 的原生方法
category:
    - JavaScript
tag:
    - 原生方法
order: 2
---

## forEach 方法

- 挂载到 Array 对象的原型 prototype 上
- 参数有 `callback` 和 `thisArg`
- `callback` 的类型为 Function，且有 3 个参数

::: code-tabs

@tab TS

```ts
type fnType<T> = (value: T, index: number, array: T[]) => void

interface Array<T> {
    myForEach(callback: fnType<T>): void
}

Object.defineProperty(Array.prototype, 'myForEach', {
    enumerable: false,
    writable: false,
    configurable: false,
    value: function myForEach<T>(this: T[], callback: fnType<T>, thisArg?: any) {
        thisArg = thisArg || this

        for (let i = 0; i < this.length; i++) {
            callback.call(thisArg, this[i], i, thisArg)
        }
    }
})
```

@tab JS

```js
Array.prototype.myForEach = function(callback, thisArg) {
    if (typeof callback !== 'function') {
        throw new Error('callbackFn must be function')
    }

    thisArg = thisArg || this
    fot (let i = 0; i < this.length; i ++) {
        callback.call(thisArg, this[i], i, this)
    }
}
```

:::

<!-- more -->

## map 方法

- 挂载到 Array 对象的原型 prototype 上
- 参数有 `callback` 和 `thisArg`
- `callback` 的类型为 Function，且有 3 个参数
- 返回数组 Array，每个元素均为 `callback` 的返回值

::: code-tabs

@tab TS

```ts
type fnType<T> = (value: T, index: number, array: T[]) => unknown

interface Array<T> {
    myMap(callback: fnType<T>): unknown[]
}

Object.defineProperty(Array.prototype, 'myMap', {
    enumerable: false,
    writable: false,
    configurable: false,
    value: function myMap<T>(this: T[], callback: fnType<T>, thisArg?: any): unknown[] {
        const result = new Array<unknown>()
        thisArg = thisArg || this

        for (let i = 0; i < this.length; i++) {
            result.push(callback.call(thisArg, this[i], i, this))
        }

        return result
    }
})
```

@tab JS

```js
Array.prototype.myMap = function(callback, thisArg) {
    if (typeof callback !== 'function') {
        throw new Error('callback must be function')
    }

    const result = new Array()
    thisArg = thisArg || this

    for (let i = 0; i < this.length; i++) {
        result.push(callbackFn.call(thisArg, this[i], i, this))
    }

    return result
}
```

:::

## filter 方法

- 挂载到 Array 对象的原型 prototype 上
- 参数有 `callback` 和 `thisArg`
- `callback` 的类型为 Function，且有 3 个参数
- 返回数组 Array，其各个元素均符合 `callback` 的测试条件，且为浅拷贝

::: code-tabs

@tab TS

```ts
type fnType<T> = (value: T, index: number, array: T[]) => boolean

interface Array<T> {
    myFilter(callback: fnType<T>): T[]
}

Object.defineProperty(Array.prototype, 'myFilter', {
    enumerable: false,
    writable: false,
    configurable: false,
    value: function myFilter<T>(this: T[], callback: fnType<T>, thisArg?: any): T[] {
        const result = new Array<T>()
        thisArg = thisArg || this

        for (let i = 0; i < this.length; i++) {
            callback.call(thisArg, this[i], i, this) && result.push(this[i])
        }

        return result
    }
})
```

@tab JS

```js
Array.prototype.myFilter = function(callback, thisArg) {
    if (typeof callback !== 'function') {
        throw new Error('callback must be function')
    }

    thisArg = thisArg || this
    const result = new Array()

    for (let i = 0; i < this.length; i++) {
        if (callbackFn.call(thisArg, this[i], i, this)) {
            callback.call(thisArg, this[i], i, this) && result.push(this[i])
        }
    }

    return arr
}
```

:::
